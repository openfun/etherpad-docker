version: "3.4"

services:

  # --- Core services
  nginx:
    image: nginx
    ports:
      - "9001:9001"
    volumes:
      - ./docker/files/etc/nginx/conf.d:/etc/nginx/conf.d:ro
    depends_on:
      - etherpad

  postgresql:
    image: postgres:9.6
    environment:
      POSTGRES_DB: etherpad
      POSTGRES_USER: foo
      POSTGRES_PASSWORD: pass

  etherpad:
    build:
      context: .
      target: production
    image: etherpad:production
    environment:
      DB_TYPE: postgres
      DB_NAME: etherpad
      DB_USER: foo
      DB_PASS: pass
      DB_HOST: postgresql
      DB_PORT: 5432
      SKIN_NAME: "education"
      LOGLEVEL: "debug"
    user: "${DOCKER_USER:-1000}"
    volumes:
      - ./private/SESSIONKEY.txt:/app/SESSIONKEY.txt
      - ./private/APIKEY.txt:/app/APIKEY.txt
      # Custom plugins/skins development
      - ./src/static/skins/education:/app/src/static/skins/education
    depends_on:
      - postgresql

  # --- Extra tools
  dockerize:
    image: jwilder/dockerize

  netshoot:
    image: nicolaka/netshoot
